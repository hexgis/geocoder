{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&family=Roboto:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css?{% now "U" %}"/>
    <script src="{% static '/js/script.js' %}" type="text/javascript"></script>
  </head>
  <body>
    <div class="main-row">
    <div class="header"><h1>GEOCODER</h1></div>
    <div class="options">
        <form class="location" id="search">
          <input class="text-inp"
            id="location"
            type="text"
            name="location"
            value="{{ current_location }}"
            placeholder="enter a location"
          />
          <input class="button" type="submit" value="search"><a href="/search?location={{ current_location }}"></a></input>
        </form>
          <div class="space"></div>
        <form class="lat-lon" id="reverse">
          <input class="lat-lon-inp"
            id="lat"
            type="text"
            name="lat"
            value="{{ current_latitude }}"
            placeholder="enter latitude"
          />
          <input class="lat-lon-inp"
            id="lon"
            type="text"
            name="lon"
            value="{{ current_longitude }}"
            placeholder="enter longitude"
          />
        <input class="button" type="submit" value="reverse"><a href="/reverse?lat={{ current_latitude }}&lon={{ current_longitude }}"></a></input>
        </form>
        <div id="display-results"></div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
  <script>
    let form = document.getElementById('search'); // selecting the form
    let reverse = document.getElementById('reverse'); // selecting the form

    function makeUL(json) {
      // Create list element
      var list = document.createElement('ul');

      for(var i = 0; i < Object.keys(json).length; i++) {
          // Create list item
          var item = document.createElement('li');

          // Set contents
          item.appendChild(document.createTextNode(Object.values(json)[i]));

          // Add to the list
          list.appendChild(item);

      }
      // Return list
      return list;
    }


    
    form.addEventListener('submit', function(event) {
        event.preventDefault()
    
        let data = new FormData();
        
        data.append("location", document.getElementById('location').value)
        data.append("lat", document.getElementById('lat').value)
        data.append("lon", document.getElementById('lon').value)
        data.append("csrfmiddlewaretoken", '{{csrf_token}}')
        
        
        axios.post('search/', data)
        .then(res => {
          var names = []
          var features = res.data.features
          for(var i=0; i<features.length;i++) {
            names.push(features[i].properties.name)
          }
          console.log(names)
          // Display list with results:
          document.getElementById('display-results').appendChild(makeUL(names));
          
        })
        
    })

    reverse.addEventListener('submit', function(event) {
        event.preventDefault()
    
        let data = new FormData();
        
        data.append("lat", document.getElementById('lat').value)
        data.append("lon", document.getElementById('lon').value)
        data.append("csrfmiddlewaretoken", '{{csrf_token}}')
        
        axios.post('reverse/', data)
        .then(res => {
          var features = res.data.features
          var output = features[0].properties.name
          // Display list with results
          document.getElementById('display-results').innerHTML=output;
          
        }) 
    })


    </script>
    
  </body>
</html>
